<html>

<head>
    <title>Examples | Terrain</title>
    <script src="/src/aframe-v0.4.0.min.js"></script>
    <script src="/src/aframe-extras-v3.1.0.min.js"></script>
<!--    <script src="/src/aframe-gamepad-controls.min.js"></script>-->
</head>

<body>
    <a-scene id="scene">
        
        <!-- Assets -->
        <a-assets>
<!--            <a-asset-item id="islandPly" src="ply/island.ply"></a-asset-item>            -->
            
            <!-- Island -->
            <a-asset-item id="islandObj" src="obj/island/island.obj"></a-asset-item>
            <a-asset-item id="islandMtl" src="obj/island/island.mtl"></a-asset-item>  
            
            <!-- Box -->
            <a-asset-item id="boxObj" src="obj/box/box.obj"></a-asset-item>
            <a-asset-item id="boxMtl" src="obj/box/box.mtl"></a-asset-item>
            
            <!-- Tree -->
            <a-asset-item id="treeObj" src="obj/tree/tree.obj"></a-asset-item>
            <a-asset-item id="treeMtl" src="obj/tree/tree.mtl"></a-asset-item>  
            
            <!-- Abstract -->
            <a-asset-item id="abstractDae" src="dae/abstract.dae"></a-asset-item>              
        </a-assets>
        
        <!-- more Islands -->
        <a-entity position="-100 -0.2 -40">
            <a-entity position="-4.3 1.3 4" rotation="0 90 0" scale="0.4 0.4 0.4" obj-model="obj: #treeObj; mtl: #treeMtl"></a-entity>             
            <a-entity position="0 0.2 0" scale="0.6 0.6 0.6" obj-model="obj: #islandObj; mtl: #islandMtl"></a-entity>                    
        </a-entity>
        <a-entity position="-150 -0.2 90">
            <a-entity position="-4.3 1 4" rotation="0 90 0" scale="0.4 0.4 0.4" obj-model="obj: #treeObj; mtl: #treeMtl"></a-entity>                         
            <a-entity position="4.3 1 -6" rotation="0 90 0" scale="0.4 0.4 0.4" obj-model="obj: #treeObj; mtl: #treeMtl"></a-entity>                         
            <a-entity position="8.3 1 -4" rotation="0 90 0" scale="0.4 0.4 0.4" obj-model="obj: #treeObj; mtl: #treeMtl"></a-entity>                         

            <a-entity position="0 -0.2 0" scale="0.4 0.4 0.4" obj-model="obj: #islandObj; mtl: #islandMtl"></a-entity>        
        </a-entity>
        <a-entity position="150 -0.2 90">
            <a-entity position="-5.3 1.3 3" rotation="0 90 0" scale="0.4 0.4 0.4" obj-model="obj: #treeObj; mtl: #treeMtl"></a-entity>              
            <a-entity position="-1.3 1.2 -3" rotation="0 90 0" scale="0.4 0.4 0.4" obj-model="obj: #treeObj; mtl: #treeMtl"></a-entity>              
            <a-entity position="4.3 1 4" rotation="0 90 0" scale="0.4 0.4 0.4" obj-model="obj: #treeObj; mtl: #treeMtl"></a-entity> 
            <a-entity position="6.3 1.2 6" rotation="0 90 0" scale="0.4 0.4 0.4" obj-model="obj: #treeObj; mtl: #treeMtl"></a-entity>                          
            <a-entity position="0 -0.2 0" scale="0.5 0.5 0.5" obj-model="obj: #islandObj; mtl: #islandMtl"></a-entity>        
        </a-entity>
        <a-entity position="100 -0.2 -90">
            <a-entity position="-3.3 1.5 3" rotation="0 90 0" scale="0.4 0.4 0.4" obj-model="obj: #treeObj; mtl: #treeMtl"></a-entity>                         
            <a-entity position="3.3 1.3 3" rotation="0 90 0" scale="0.4 0.4 0.4" obj-model="obj: #treeObj; mtl: #treeMtl"></a-entity>                         
            <a-entity position="-3.3 1.5 -3" rotation="0 90 0" scale="0.4 0.4 0.4" obj-model="obj: #treeObj; mtl: #treeMtl"></a-entity>                         

            <a-entity position="0 1 0" scale="0.3 0.3 0.3" obj-model="obj: #islandObj; mtl: #islandMtl"></a-entity>        
        </a-entity>  
        <a-entity position="30 -0.2 120">
            <a-entity position="-4.3 1.3 4" rotation="0 90 0" scale="0.4 0.4 0.4" obj-model="obj: #treeObj; mtl: #treeMtl"></a-entity>                         
            <a-entity position="0 0 0" scale="0.5 0.5 0.5" obj-model="obj: #islandObj; mtl: #islandMtl"></a-entity>        
        </a-entity>
        <a-entity position="-20 -0.2 -70">
            <a-entity position="-4.3 2.5 4" rotation="0 90 0" scale="0.4 0.4 0.4" obj-model="obj: #treeObj; mtl: #treeMtl"></a-entity>
            <a-entity position="-12.3 2.2 6" rotation="0 90 0" scale="0.4 0.4 0.4" obj-model="obj: #treeObj; mtl: #treeMtl"></a-entity>                         
            <a-entity position="8.3 2.5 8" rotation="0 90 0" scale="0.4 0.4 0.4" obj-model="obj: #treeObj; mtl: #treeMtl"></a-entity>                         
            <a-entity position="-4.3 2.3 -4" rotation="0 90 0" scale="0.4 0.4 0.4" obj-model="obj: #treeObj; mtl: #treeMtl"></a-entity>                         
            <a-entity position="-10 2.4 4" rotation="0 90 0" scale="0.4 0.4 0.4" obj-model="obj: #treeObj; mtl: #treeMtl"></a-entity>                         
            <a-entity position="2 2.5 -2" rotation="0 90 0" scale="0.4 0.4 0.4" obj-model="obj: #treeObj; mtl: #treeMtl"></a-entity>                         
            
            <a-entity position="0 0.2 0" scale="0.8 0.8 0.8" obj-model="obj: #islandObj; mtl: #islandMtl"></a-entity>        
        </a-entity>         
        
        <a-entity position="0 0 0" id="island_wrap">
            
            <!-- Camera -->
            <a-entity position="3.8 1.5 0" rotation="0 90 0">
                <a-camera gamepad-controls universal-controls>
                    <a-ring id="cursor" radius-outer="0.15" radius-inner="0.10" scale="0.1 0.1 0.1" position="0 0 -0.3" material="color: #a3a3a3; shader: flat; opacity: 0.8;" cursor="maxDistance: 30; fuse: false"></a-ring>                    
                </a-camera>
            </a-entity>            
            
            <!-- Island -->
    <!--        <a-entity position="0 -0.2 0" scale="0.5 0.5 0.5" ply-model="src: #islandPly" rotation="-90 0 0"></a-entity>-->
            <a-entity position="0 -0.2 0" scale="0.5 0.5 0.5" obj-model="obj: #islandObj; mtl: #islandMtl"></a-entity>        

            <!-- Box -->
            <a-entity position="-4.3 1.3 0" scale="0.4 0.4 0.4" obj-model="obj: #boxObj; mtl: #boxMtl"></a-entity>   

            <!-- Trees -->
            <a-entity gamepad-click-listener id="trigger_tree" position="-4.3 1.3 4" rotation="0 90 0" scale="0.4 0.4 0.4" obj-model="obj: #treeObj; mtl: #treeMtl"></a-entity> 
            
            <a-entity gamepad-click-listener id="other_tree" position="-4.3 1.3 -5.6" rotation="0 90 0" scale="0.4 0.4 0.4" obj-model="obj: #treeObj; mtl: #treeMtl">
                <a-animation attribute="position" from="-4.3 1.3 -5.6" to="-4.3 -5 -5.6" dur="1000" begin="click" fill="forwards"></a-animation>
            </a-entity>             

            <a-collada-model position="-4.3 5.25 0" scale="0.6 0.6 0.6" color="#7b7bb7" src="#abstractDae"></a-collada-model>
            
            <!-- sinking island -->
            <a-animation attribute="position" from="0 0 0" to="0 -15 0" dur="15000" begin="sink"></a-animation>
        </a-entity>      
        
        <!-- Ocean -->
        <a-ocean width="350" depth="350" density="80" opacity="0.8" position="0 0 0"></a-ocean>

        <!-- Sky -->
        <a-sky color="#AADDF0"></a-sky>

        <!-- Lighting -->
        <a-light type="ambient" color="#ccc"></a-light>
        <a-light color="#ddf" distance="100" intensity="0.4" type="point"></a-light>
        <a-light color="#ddf" position="3 10 -10" distance="50" intensity="0.4" type="point"></a-light>

    </a-scene>
    
    <script>

        AFRAME.registerComponent('gamepad-click-listener', {
          init: function () {
              
            var el = this.el; 
            var hovered = false;
              
            el.addEventListener('mouseenter', function () {
                hovered = true;
            });
              
            el.addEventListener('mouseleave', function () {
                hovered = false;
            });              
              
            window.addEventListener('gamepadbuttondown', function (e) {
                if(e.detail.index === 1 && hovered)Â {
                    console.log('I was clicked!'); 
                    el.emit('click');
                }
            });
          }
        });

        document.querySelector('#trigger_tree').addEventListener('click', function () { 
            console.log('island is sinking');
            document.querySelector('#island_wrap').emit('sink');            
        });
    </script>    
</body>

</html>